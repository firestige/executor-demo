<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/integration/PipelineContextCheckpointIntegrationTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/integration/PipelineContextCheckpointIntegrationTest.java" />
              <option name="updatedContent" value="package xyz.firestige.executor.integration;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Tag;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import xyz.firestige.dto.TenantDeployConfig;&#10;import xyz.firestige.executor.execution.checkpoint.Checkpoint;&#10;import xyz.firestige.executor.execution.pipeline.InMemoryCheckpointManager;&#10;import xyz.firestige.executor.execution.pipeline.PipelineContext;&#10;import xyz.firestige.executor.util.TestDataFactory;&#10;import xyz.firestige.executor.util.TimingExtension;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * PipelineContext 与 CheckpointManager 集成测试&#10; * 测试上下文和检查点的协作&#10; */&#10;@Tag(&quot;integration&quot;)&#10;@Tag(&quot;standard&quot;)&#10;@ExtendWith(TimingExtension.class)&#10;@DisplayName(&quot;PipelineContext + CheckpointManager 集成测试&quot;)&#10;class PipelineContextCheckpointIntegrationTest {&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 上下文数据可以保存到检查点&quot;)&#10;    void testSaveContextToCheckpoint() {&#10;        // Given: 上下文和检查点管理器&#10;        TenantDeployConfig config = TestDataFactory.createMinimalConfig(&quot;tenant1&quot;, 1001L);&#10;        PipelineContext context = new PipelineContext(&quot;task1&quot;, config);&#10;        InMemoryCheckpointManager checkpointManager = new InMemoryCheckpointManager();&#10;        &#10;        // When: 上下文中添加数据&#10;        context.putData(&quot;processedCount&quot;, 10);&#10;        context.putData(&quot;currentStage&quot;, &quot;Stage2&quot;);&#10;        &#10;        // 创建检查点并保存上下文数据&#10;        Checkpoint checkpoint = new Checkpoint(&quot;task1&quot;, &quot;Stage2&quot;);&#10;        Map&lt;String, Object&gt; contextData = new HashMap&lt;&gt;();&#10;        contextData.put(&quot;processedCount&quot;, context.getData(&quot;processedCount&quot;));&#10;        contextData.put(&quot;currentStage&quot;, context.getData(&quot;currentStage&quot;));&#10;        checkpoint.saveStageData(&quot;Stage2&quot;, contextData);&#10;        &#10;        checkpointManager.saveCheckpoint(&quot;task1&quot;, &quot;Stage2&quot;, checkpoint);&#10;        &#10;        // Then: 可以从检查点恢复数据&#10;        Checkpoint loaded = checkpointManager.loadCheckpoint(&quot;task1&quot;);&#10;        assertNotNull(loaded);&#10;        Map&lt;String, Object&gt; restoredData = loaded.getStageData(&quot;Stage2&quot;);&#10;        assertEquals(10, restoredData.get(&quot;processedCount&quot;));&#10;        assertEquals(&quot;Stage2&quot;, restoredData.get(&quot;currentStage&quot;));&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 暂停时保存检查点，恢复时加载&quot;)&#10;    void testPauseAndResume() {&#10;        // Given: 上下文和检查点管理器&#10;        PipelineContext context = new PipelineContext(&quot;task1&quot;, &#10;            TestDataFactory.createMinimalConfig(&quot;tenant1&quot;, 1001L));&#10;        InMemoryCheckpointManager checkpointManager = new InMemoryCheckpointManager();&#10;        &#10;        // When: 执行到某个阶段后暂停&#10;        context.putData(&quot;completedStages&quot;, 3);&#10;        context.requestPause();&#10;        &#10;        // 保存检查点&#10;        Checkpoint checkpoint = new Checkpoint(&quot;task1&quot;, &quot;Stage3&quot;);&#10;        Map&lt;String, Object&gt; pauseData = new HashMap&lt;&gt;();&#10;        pauseData.put(&quot;completedStages&quot;, 3);&#10;        pauseData.put(&quot;pauseRequested&quot;, true);&#10;        checkpoint.saveStageData(&quot;Stage3&quot;, pauseData);&#10;        checkpointManager.saveCheckpoint(&quot;task1&quot;, &quot;Stage3&quot;, checkpoint);&#10;        &#10;        // Then: 可以检测到暂停状态&#10;        assertTrue(context.shouldPause());&#10;        assertTrue(checkpointManager.hasCheckpoint(&quot;task1&quot;));&#10;        &#10;        // When: 恢复&#10;        context.resume();&#10;        &#10;        // Then: 暂停标志清除，但检查点仍存在&#10;        assertFalse(context.shouldPause());&#10;        assertTrue(checkpointManager.hasCheckpoint(&quot;task1&quot;));&#10;        &#10;        // 可以从检查点恢复数据&#10;        Checkpoint loadedCheckpoint = checkpointManager.loadCheckpoint(&quot;task1&quot;);&#10;        Map&lt;String, Object&gt; resumeData = loadedCheckpoint.getStageData(&quot;Stage3&quot;);&#10;        assertEquals(3, resumeData.get(&quot;completedStages&quot;));&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 多个阶段的检查点保存&quot;)&#10;    void testMultipleStageCheckpoints() {&#10;        // Given: 检查点管理器&#10;        InMemoryCheckpointManager checkpointManager = new InMemoryCheckpointManager();&#10;        &#10;        // When: 保存多个阶段的检查点&#10;        Checkpoint checkpoint = new Checkpoint(&quot;task1&quot;, &quot;Stage3&quot;);&#10;        &#10;        // Stage1 数据&#10;        Map&lt;String, Object&gt; stage1Data = new HashMap&lt;&gt;();&#10;        stage1Data.put(&quot;status&quot;, &quot;completed&quot;);&#10;        checkpoint.saveStageData(&quot;Stage1&quot;, stage1Data);&#10;        &#10;        // Stage2 数据&#10;        Map&lt;String, Object&gt; stage2Data = new HashMap&lt;&gt;();&#10;        stage2Data.put(&quot;status&quot;, &quot;completed&quot;);&#10;        checkpoint.saveStageData(&quot;Stage2&quot;, stage2Data);&#10;        &#10;        // Stage3 数据&#10;        Map&lt;String, Object&gt; stage3Data = new HashMap&lt;&gt;();&#10;        stage3Data.put(&quot;status&quot;, &quot;running&quot;);&#10;        checkpoint.saveStageData(&quot;Stage3&quot;, stage3Data);&#10;        &#10;        checkpointManager.saveCheckpoint(&quot;task1&quot;, &quot;Stage3&quot;, checkpoint);&#10;        &#10;        // Then: 可以加载所有阶段的数据&#10;        Checkpoint loaded = checkpointManager.loadCheckpoint(&quot;task1&quot;);&#10;        assertTrue(loaded.hasStageData(&quot;Stage1&quot;));&#10;        assertTrue(loaded.hasStageData(&quot;Stage2&quot;));&#10;        assertTrue(loaded.hasStageData(&quot;Stage3&quot;));&#10;        assertEquals(&quot;completed&quot;, loaded.getStageData(&quot;Stage1&quot;).get(&quot;status&quot;));&#10;        assertEquals(&quot;running&quot;, loaded.getStageData(&quot;Stage3&quot;).get(&quot;status&quot;));&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/dto/DtoTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/dto/DtoTest.java" />
              <option name="updatedContent" value="package xyz.firestige.executor.unit.dto;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Tag;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import xyz.firestige.dto.NetworkEndpoint;&#10;import xyz.firestige.dto.TenantDeployConfig;&#10;import xyz.firestige.executor.util.TimingExtension;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * DTO 类单元测试&#10; * 测试数据传输对象的基本功能&#10; */&#10;@Tag(&quot;unit&quot;)&#10;@Tag(&quot;fast&quot;)&#10;@ExtendWith(TimingExtension.class)&#10;@DisplayName(&quot;DTO 类单元测试&quot;)&#10;class DtoTest {&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: TenantDeployConfig 基本属性&quot;)&#10;    void testTenantDeployConfigBasicProperties() {&#10;        // Given: 创建配置&#10;        TenantDeployConfig config = new TenantDeployConfig();&#10;        &#10;        // When: 设置属性&#10;        config.setTenantId(&quot;tenant123&quot;);&#10;        config.setPlanId(1001L);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;tenant123&quot;, config.getTenantId());&#10;        assertEquals(1001L, config.getPlanId());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: TenantDeployConfig 网络端点列表&quot;)&#10;    void testTenantDeployConfigNetworkEndpoints() {&#10;        // Given: 配置和端点列表&#10;        TenantDeployConfig config = new TenantDeployConfig();&#10;        List&lt;NetworkEndpoint&gt; endpoints = new ArrayList&lt;&gt;();&#10;        &#10;        NetworkEndpoint endpoint1 = new NetworkEndpoint();&#10;        endpoint1.setKey(&quot;endpoint1&quot;);&#10;        endpoint1.setSourceIp(&quot;192.168.1.1&quot;);&#10;        endpoints.add(endpoint1);&#10;        &#10;        NetworkEndpoint endpoint2 = new NetworkEndpoint();&#10;        endpoint2.setKey(&quot;endpoint2&quot;);&#10;        endpoint2.setSourceIp(&quot;192.168.1.2&quot;);&#10;        endpoints.add(endpoint2);&#10;        &#10;        // When: 设置端点列表&#10;        config.setNetworkEndpoints(endpoints);&#10;        &#10;        // Then: 列表正确&#10;        assertNotNull(config.getNetworkEndpoints());&#10;        assertEquals(2, config.getNetworkEndpoints().size());&#10;        assertEquals(&quot;endpoint1&quot;, config.getNetworkEndpoints().get(0).getKey());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: NetworkEndpoint 基本属性&quot;)&#10;    void testNetworkEndpointBasicProperties() {&#10;        // Given: 创建端点&#10;        NetworkEndpoint endpoint = new NetworkEndpoint();&#10;        &#10;        // When: 设置属性&#10;        endpoint.setKey(&quot;ep1&quot;);&#10;        endpoint.setSourceIp(&quot;10.0.0.1&quot;);&#10;        endpoint.setSourceDomain(&quot;source.example.com&quot;);&#10;        endpoint.setTargetIp(&quot;10.0.0.2&quot;);&#10;        endpoint.setTargetDomain(&quot;target.example.com&quot;);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;ep1&quot;, endpoint.getKey());&#10;        assertEquals(&quot;10.0.0.1&quot;, endpoint.getSourceIp());&#10;        assertEquals(&quot;source.example.com&quot;, endpoint.getSourceDomain());&#10;        assertEquals(&quot;10.0.0.2&quot;, endpoint.getTargetIp());&#10;        assertEquals(&quot;target.example.com&quot;, endpoint.getTargetDomain());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: NetworkEndpoint 支持只有域名&quot;)&#10;    void testNetworkEndpointDomainOnly() {&#10;        // Given: 只使用域名的端点&#10;        NetworkEndpoint endpoint = new NetworkEndpoint();&#10;        &#10;        // When: 只设置域名&#10;        endpoint.setKey(&quot;ep2&quot;);&#10;        endpoint.setSourceDomain(&quot;source.example.com&quot;);&#10;        endpoint.setTargetDomain(&quot;target.example.com&quot;);&#10;        &#10;        // Then: 域名正确，IP为null&#10;        assertEquals(&quot;ep2&quot;, endpoint.getKey());&#10;        assertNull(endpoint.getSourceIp());&#10;        assertNull(endpoint.getTargetIp());&#10;        assertEquals(&quot;source.example.com&quot;, endpoint.getSourceDomain());&#10;        assertEquals(&quot;target.example.com&quot;, endpoint.getTargetDomain());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: NetworkEndpoint 支持只有IP&quot;)&#10;    void testNetworkEndpointIpOnly() {&#10;        // Given: 只使用IP的端点&#10;        NetworkEndpoint endpoint = new NetworkEndpoint();&#10;        &#10;        // When: 只设置IP&#10;        endpoint.setKey(&quot;ep3&quot;);&#10;        endpoint.setSourceIp(&quot;192.168.1.1&quot;);&#10;        endpoint.setTargetIp(&quot;192.168.1.2&quot;);&#10;        &#10;        // Then: IP正确，域名为null&#10;        assertEquals(&quot;ep3&quot;, endpoint.getKey());&#10;        assertEquals(&quot;192.168.1.1&quot;, endpoint.getSourceIp());&#10;        assertEquals(&quot;192.168.1.2&quot;, endpoint.getTargetIp());&#10;        assertNull(endpoint.getSourceDomain());&#10;        assertNull(endpoint.getTargetDomain());&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/execution/CheckpointTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/execution/CheckpointTest.java" />
              <option name="updatedContent" value="package xyz.firestige.executor.unit.execution;&#10;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Tag;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import xyz.firestige.dto.TenantDeployConfig;&#10;import xyz.firestige.executor.execution.checkpoint.Checkpoint;&#10;import xyz.firestige.executor.util.TestDataFactory;&#10;import xyz.firestige.executor.util.TimingExtension;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * Checkpoint 单元测试&#10; * 测试检查点数据类&#10; */&#10;@Tag(&quot;unit&quot;)&#10;@Tag(&quot;fast&quot;)&#10;@ExtendWith(TimingExtension.class)&#10;@DisplayName(&quot;Checkpoint 单元测试&quot;)&#10;class CheckpointTest {&#10;    &#10;    private Checkpoint checkpoint;&#10;    &#10;    @BeforeEach&#10;    void setUp() {&#10;        checkpoint = new Checkpoint(&quot;task1&quot;, &quot;stage2&quot;);&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 基本属性&quot;)&#10;    void testBasicProperties() {&#10;        // Then: 基本属性正确&#10;        assertEquals(&quot;task1&quot;, checkpoint.getTaskId());&#10;        assertEquals(&quot;stage2&quot;, checkpoint.getStageName());&#10;        assertNotNull(checkpoint.getTimestamp());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 保存和获取Stage数据&quot;)&#10;    void testSaveAndGetStageData() {&#10;        // Given: Stage数据&#10;        Map&lt;String, Object&gt; stageData = new HashMap&lt;&gt;();&#10;        stageData.put(&quot;completedCount&quot;, 5);&#10;        stageData.put(&quot;status&quot;, &quot;running&quot;);&#10;        &#10;        // When: 保存数据&#10;        checkpoint.saveStageData(&quot;stage1&quot;, stageData);&#10;        &#10;        // Then: 可以获取数据&#10;        assertTrue(checkpoint.hasStageData(&quot;stage1&quot;));&#10;        Map&lt;String, Object&gt; retrieved = checkpoint.getStageData(&quot;stage1&quot;);&#10;        assertEquals(5, retrieved.get(&quot;completedCount&quot;));&#10;        assertEquals(&quot;running&quot;, retrieved.get(&quot;status&quot;));&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 多个Stage数据&quot;)&#10;    void testMultipleStageData() {&#10;        // Given: 多个Stage的数据&#10;        Map&lt;String, Object&gt; stage1Data = new HashMap&lt;&gt;();&#10;        stage1Data.put(&quot;key1&quot;, &quot;value1&quot;);&#10;        &#10;        Map&lt;String, Object&gt; stage2Data = new HashMap&lt;&gt;();&#10;        stage2Data.put(&quot;key2&quot;, &quot;value2&quot;);&#10;        &#10;        // When: 保存多个Stage数据&#10;        checkpoint.saveStageData(&quot;stage1&quot;, stage1Data);&#10;        checkpoint.saveStageData(&quot;stage2&quot;, stage2Data);&#10;        &#10;        // Then: 都可以获取&#10;        assertTrue(checkpoint.hasStageData(&quot;stage1&quot;));&#10;        assertTrue(checkpoint.hasStageData(&quot;stage2&quot;));&#10;        assertEquals(&quot;value1&quot;, checkpoint.getStageData(&quot;stage1&quot;).get(&quot;key1&quot;));&#10;        assertEquals(&quot;value2&quot;, checkpoint.getStageData(&quot;stage2&quot;).get(&quot;key2&quot;));&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 不存在的Stage数据&quot;)&#10;    void testNonexistentStageData() {&#10;        // When: 查询不存在的Stage&#10;        boolean hasData = checkpoint.hasStageData(&quot;nonexistent&quot;);&#10;        &#10;        // Then: 返回false&#10;        assertFalse(hasData);&#10;        assertNull(checkpoint.getStageData(&quot;nonexistent&quot;));&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景: 覆盖Stage数据&quot;)&#10;    void testOverwriteStageData() {&#10;        // Given: 初始数据&#10;        Map&lt;String, Object&gt; originalData = new HashMap&lt;&gt;();&#10;        originalData.put(&quot;count&quot;, 1);&#10;        checkpoint.saveStageData(&quot;stage1&quot;, originalData);&#10;        &#10;        // When: 覆盖数据&#10;        Map&lt;String, Object&gt; newData = new HashMap&lt;&gt;();&#10;        newData.put(&quot;count&quot;, 2);&#10;        checkpoint.saveStageData(&quot;stage1&quot;, newData);&#10;        &#10;        // Then: 数据被覆盖&#10;        assertEquals(2, checkpoint.getStageData(&quot;stage1&quot;).get(&quot;count&quot;));&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>