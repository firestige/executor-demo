<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/RF01_PROGRESS.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/RF01_PROGRESS.md" />
              <option name="originalContent" value="# RF-01 重构进度跟踪&#10;&#10;**开始日期**: 2025-11-17  &#10;**预计完成**: 2025-11-XX（5.5 天）  &#10;**当前状态**: ⏳ 待开始&#10;&#10;---&#10;&#10;##  整体进度&#10;&#10;- [x] Phase 1: 创建 Result DTO（0.5 天）✅&#10;- [ ] Phase 2: 创建内部 DTO（0.5 天）&#10;- [ ] Phase 3: 创建应用服务层（2 天）&#10;- [ ] Phase 4: 创建新 Facade（1 天）&#10;- [ ] Phase 5: 删除旧代码（1 天）&#10;- [ ] Phase 6: 验证与文档（0.5 天）&#10;&#10;**完成百分比**: 17%&#10;&#10;---&#10;&#10;##  Phase 详细进度&#10;&#10;### Phase 1: 创建 Result DTO ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 0.5 天  &#10;**Git Tag**: `rf01-phase1-result-dto`&#10;&#10;**任务清单**:&#10;- [ ] 创建 `xyz.firestige.executor.application.dto` 包&#10;- [ ] 创建 `PlanCreationResult.java`&#10;- [ ] 创建 `PlanInfo.java`（值对象，不可变）&#10;- [ ] 创建 `TaskInfo.java`（值对象，不可变）&#10;- [ ] 创建 `PlanOperationResult.java`&#10;- [ ] 创建 `TaskOperationResult.java`（新版本）&#10;- [ ] 实现静态工厂方法（`from`、`success`、`failure`）&#10;- [ ] 编写单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 2: 创建内部 DTO ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 0.5 天  &#10;**Git Tag**: `rf01-phase2-internal-dto`&#10;&#10;**任务清单**:&#10;- [ ] 在 `application.dto` 包中创建 `TenantConfig.java`&#10;- [ ] 参考 `TenantDeployConfig` 设计字段&#10;- [ ] 只包含应用层需要的字段&#10;- [ ] 编写单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 3: 创建应用服务层 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 2 天  &#10;**Git Tag**: `rf01-phase3-application-service`&#10;&#10;**任务清单**:&#10;- [ ] 创建 `xyz.firestige.executor.application` 包&#10;- [ ] 创建 `PlanApplicationService.java`&#10;  - [ ] 从 Facade 迁移 `createSwitchTask` 业务逻辑&#10;  - [ ] 修改参数类型为 `List&lt;TenantConfig&gt;`&#10;  - [ ] 修改返回值为 `PlanCreationResult`&#10;  - [ ] 迁移所有注册表字段&#10;  - [ ] 迁移 Plan 级别操作方法&#10;- [ ] 创建 `TaskApplicationService.java`&#10;  - [ ] 迁移 Task 级别操作方法&#10;  - [ ] 返回值为 `TaskOperationResult`&#10;- [ ] 编写应用服务层单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 4: 创建新 Facade ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 1 天  &#10;**Git Tag**: `rf01-phase4-new-facade`&#10;&#10;**任务清单**:&#10;- [ ] 创建 `xyz.firestige.executor.facade.exception` 包&#10;- [ ] 创建异常类&#10;  - [ ] `TaskCreationException.java`&#10;  - [ ] `TaskOperationException.java`&#10;  - [ ] `TaskNotFoundException.java`&#10;  - [ ] `PlanNotFoundException.java`&#10;- [ ] 重命名旧 Facade：`DeploymentTaskFacadeImpl` → `DeploymentTaskFacadeImpl_OLD`&#10;- [ ] 创建新 `DeploymentTaskFacade.java`（无接口）&#10;  - [ ] 实现 DTO 转换逻辑&#10;  - [ ] 实现异常转换逻辑&#10;  - [ ] 调用应用服务层&#10;  - [ ] 分别处理 `PlanOperationResult` 和 `TaskOperationResult`&#10;- [ ] 编写 Facade 层单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 5: 删除旧代码 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 1 天  &#10;**Git Tag**: `rf01-phase5-cleanup`&#10;&#10;**任务清单**:&#10;- [ ] 更新集成测试（断言异常）&#10;- [ ] 更新所有引用旧 Facade 的地方&#10;- [ ] 删除旧代码&#10;  - [ ] 删除 `DeploymentTaskFacadeImpl_OLD`&#10;  - [ ] 删除 `facade/TaskCreationResult.java`&#10;  - [ ] 删除 `facade/TaskOperationResult.java`&#10;  - [ ] 删除 `facade/TaskStatusInfo.java`（如果有新版本）&#10;- [ ] 运行完整测试套件&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 6: 验证与文档 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 0.5 天  &#10;&#10;**任务清单**:&#10;- [ ] 运行完整测试套件（`mvn clean test`）&#10;- [ ] 检查测试覆盖率&#10;- [ ] 更新文档&#10;  - [ ] 更新 `ARCHITECTURE_PROMPT.md`（反映新架构设计）&#10;  - [ ] 更新 `TODO.md`（标记 RF-01 完成）&#10;  - [ ] 更新 `develop.log`（记录变更，包含本次重构的核心价值）&#10;- [ ] Code Review&#10;- [ ] 性能回归测试（可选）&#10;- [ ] **移除重构文档**（核心信息已归档到主文档）&#10;  - [ ] 删除 `RF01_PROGRESS.md`&#10;  - [ ] 删除 `RF01_README.md`&#10;  - [ ] 删除 `RF01_FINAL_SUMMARY.md`&#10;  - [ ] 删除 `RF01_DESIGN_DECISIONS.md`&#10;  - [ ] 删除 `RF01_REFACTOR_PROPOSAL.md`&#10;  - [ ] 删除 `RF01_RESULT_DTO_ANALYSIS.md`&#10;  - [ ] 确认所有重构文档已删除，工作区干净&#10;&#10;**完成时间**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;##  会话恢复指令&#10;&#10;如果会话中断，在新会话中使用以下指令快速恢复：&#10;&#10;```&#10;请阅读 RF01_PROGRESS.md 了解当前进度，&#10;然后继续实施下一个未完成的 Phase。&#10;参考 RF01_REFACTOR_PROPOSAL.md 中的详细设计。&#10;```&#10;&#10;---&#10;&#10;##  变更记录&#10;&#10;| 日期 | Phase | 说明 | 提交 ID |&#10;|------|-------|------|---------|&#10;| 2025-11-17 | - | 创建进度跟踪文件 | - |&#10;|  |  |  |  |&#10;|  |  |  |  |&#10;&#10;---&#10;&#10;## ⚠️ 问题与风险&#10;&#10;| 日期 | 问题描述 | 解决方案 | 状态 |&#10;|------|----------|----------|------|&#10;|  |  |  |  |&#10;|  |  |  |  |&#10;&#10;---&#10;&#10;##  备注&#10;&#10;- 每个 Phase 完成后，更新上面的复选框和完成时间&#10;- 遇到问题记录到&quot;问题与风险&quot;表格&#10;- Git tag 命名规范：`rf01-phaseX-description`&#10;- 每天结束时更新进度，便于恢复&#10;&#10;**重构文档生命周期**：&#10;- **Phase 1-5**: 重构文档是实施指南，保留所有文件&#10;- **Phase 6**: 核心信息归档到主文档后，删除所有重构文档&#10;  - 核心设计 → `ARCHITECTURE_PROMPT.md`&#10;  - 已完成任务 → `develop.log`&#10;  - 后续计划 → `TODO.md`&#10;- **完成后**: 工作区仅保留核心项目文档，保持整洁&#10;&#10;---&#10;&#10;**最后更新**: 2025-11-17  &#10;**更新人**: [您的名字]&#10;&#10;" />
              <option name="updatedContent" value="# RF-01 重构进度跟踪&#10;&#10;**开始日期**: 2025-11-17  &#10;**预计完成**: 2025-11-XX（5.5 天）  &#10;**当前状态**: ⏳ 待开始&#10;&#10;---&#10;&#10;##  整体进度&#10;&#10;- [x] Phase 1: 创建 Result DTO（0.5 天）✅&#10;- [ ] Phase 2: 创建内部 DTO（0.5 天）&#10;- [ ] Phase 3: 创建应用服务层（2 天）&#10;- [ ] Phase 4: 创建新 Facade（1 天）&#10;- [ ] Phase 5: 删除旧代码（1 天）&#10;- [ ] Phase 6: 验证与文档（0.5 天）&#10;&#10;**完成百分比**: 17%&#10;&#10;---&#10;&#10;##  Phase 详细进度&#10;&#10;### Phase 1: 创建 Result DTO ✅&#10;&#10;**状态**: 已完成  &#10;**预计时间**: 0.5 天  &#10;**实际时间**: 0.5 天  &#10;**Git Tag**: `rf01-phase1-result-dto`&#10;&#10;**任务清单**:&#10;- [x] 创建 `xyz.firestige.executor.application.dto` 包&#10;- [x] 创建 `PlanCreationResult.java`&#10;- [x] 创建 `PlanInfo.java`（值对象，不可变）&#10;- [x] 创建 `TaskInfo.java`（值对象，不可变）&#10;- [x] 创建 `PlanOperationResult.java`&#10;- [x] 创建 `TaskOperationResult.java`（新版本）&#10;- [x] 实现静态工厂方法（`from`、`success`、`failure`）&#10;- [x] 编译验证（无错误）&#10;- [x] 运行测试（全部通过）&#10;- [x] Git commit + tag&#10;&#10;**完成时间**: 2025-11-17  &#10;**提交 ID**: rf01-phase1-result-dto (tag)  &#10;**备注**: 所有 DTO 类创建完成，编译和测试通过，已打 tag&#10;&#10;---&#10;&#10;### Phase 2: 创建内部 DTO ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 0.5 天  &#10;**Git Tag**: `rf01-phase2-internal-dto`&#10;&#10;**任务清单**:&#10;- [ ] 在 `application.dto` 包中创建 `TenantConfig.java`&#10;- [ ] 参考 `TenantDeployConfig` 设计字段&#10;- [ ] 只包含应用层需要的字段&#10;- [ ] 编写单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 3: 创建应用服务层 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 2 天  &#10;**Git Tag**: `rf01-phase3-application-service`&#10;&#10;**任务清单**:&#10;- [ ] 创建 `xyz.firestige.executor.application` 包&#10;- [ ] 创建 `PlanApplicationService.java`&#10;  - [ ] 从 Facade 迁移 `createSwitchTask` 业务逻辑&#10;  - [ ] 修改参数类型为 `List&lt;TenantConfig&gt;`&#10;  - [ ] 修改返回值为 `PlanCreationResult`&#10;  - [ ] 迁移所有注册表字段&#10;  - [ ] 迁移 Plan 级别操作方法&#10;- [ ] 创建 `TaskApplicationService.java`&#10;  - [ ] 迁移 Task 级别操作方法&#10;  - [ ] 返回值为 `TaskOperationResult`&#10;- [ ] 编写应用服务层单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 4: 创建新 Facade ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 1 天  &#10;**Git Tag**: `rf01-phase4-new-facade`&#10;&#10;**任务清单**:&#10;- [ ] 创建 `xyz.firestige.executor.facade.exception` 包&#10;- [ ] 创建异常类&#10;  - [ ] `TaskCreationException.java`&#10;  - [ ] `TaskOperationException.java`&#10;  - [ ] `TaskNotFoundException.java`&#10;  - [ ] `PlanNotFoundException.java`&#10;- [ ] 重命名旧 Facade：`DeploymentTaskFacadeImpl` → `DeploymentTaskFacadeImpl_OLD`&#10;- [ ] 创建新 `DeploymentTaskFacade.java`（无接口）&#10;  - [ ] 实现 DTO 转换逻辑&#10;  - [ ] 实现异常转换逻辑&#10;  - [ ] 调用应用服务层&#10;  - [ ] 分别处理 `PlanOperationResult` 和 `TaskOperationResult`&#10;- [ ] 编写 Facade 层单元测试&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 5: 删除旧代码 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 1 天  &#10;**Git Tag**: `rf01-phase5-cleanup`&#10;&#10;**任务清单**:&#10;- [ ] 更新集成测试（断言异常）&#10;- [ ] 更新所有引用旧 Facade 的地方&#10;- [ ] 删除旧代码&#10;  - [ ] 删除 `DeploymentTaskFacadeImpl_OLD`&#10;  - [ ] 删除 `facade/TaskCreationResult.java`&#10;  - [ ] 删除 `facade/TaskOperationResult.java`&#10;  - [ ] 删除 `facade/TaskStatusInfo.java`（如果有新版本）&#10;- [ ] 运行完整测试套件&#10;- [ ] Git commit + tag&#10;&#10;**完成时间**: ___________  &#10;**提交 ID**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;### Phase 6: 验证与文档 ⏳&#10;&#10;**状态**: 待开始  &#10;**预计时间**: 0.5 天  &#10;&#10;**任务清单**:&#10;- [ ] 运行完整测试套件（`mvn clean test`）&#10;- [ ] 检查测试覆盖率&#10;- [ ] 更新文档&#10;  - [ ] 更新 `ARCHITECTURE_PROMPT.md`（反映新架构设计）&#10;  - [ ] 更新 `TODO.md`（标记 RF-01 完成）&#10;  - [ ] 更新 `develop.log`（记录变更，包含本次重构的核心价值）&#10;- [ ] Code Review&#10;- [ ] 性能回归测试（可选）&#10;- [ ] **移除重构文档**（核心信息已归档到主文档）&#10;  - [ ] 删除 `RF01_PROGRESS.md`&#10;  - [ ] 删除 `RF01_README.md`&#10;  - [ ] 删除 `RF01_FINAL_SUMMARY.md`&#10;  - [ ] 删除 `RF01_DESIGN_DECISIONS.md`&#10;  - [ ] 删除 `RF01_REFACTOR_PROPOSAL.md`&#10;  - [ ] 删除 `RF01_RESULT_DTO_ANALYSIS.md`&#10;  - [ ] 确认所有重构文档已删除，工作区干净&#10;&#10;**完成时间**: ___________  &#10;**备注**: ___________&#10;&#10;---&#10;&#10;##  会话恢复指令&#10;&#10;如果会话中断，在新会话中使用以下指令快速恢复：&#10;&#10;```&#10;请阅读 RF01_PROGRESS.md 了解当前进度，&#10;然后继续实施下一个未完成的 Phase。&#10;参考 RF01_REFACTOR_PROPOSAL.md 中的详细设计。&#10;```&#10;&#10;---&#10;&#10;##  变更记录&#10;&#10;| 日期 | Phase | 说明 | 提交 ID |&#10;|------|-------|------|---------|&#10;| 2025-11-17 | - | 创建进度跟踪文件 | - |&#10;|  |  |  |  |&#10;|  |  |  |  |&#10;&#10;---&#10;&#10;## ⚠️ 问题与风险&#10;&#10;| 日期 | 问题描述 | 解决方案 | 状态 |&#10;|------|----------|----------|------|&#10;|  |  |  |  |&#10;|  |  |  |  |&#10;&#10;---&#10;&#10;##  备注&#10;&#10;- 每个 Phase 完成后，更新上面的复选框和完成时间&#10;- 遇到问题记录到&quot;问题与风险&quot;表格&#10;- Git tag 命名规范：`rf01-phaseX-description`&#10;- 每天结束时更新进度，便于恢复&#10;&#10;**重构文档生命周期**：&#10;- **Phase 1-5**: 重构文档是实施指南，保留所有文件&#10;- **Phase 6**: 核心信息归档到主文档后，删除所有重构文档&#10;  - 核心设计 → `ARCHITECTURE_PROMPT.md`&#10;  - 已完成任务 → `develop.log`&#10;  - 后续计划 → `TODO.md`&#10;- **完成后**: 工作区仅保留核心项目文档，保持整洁&#10;&#10;---&#10;&#10;**最后更新**: 2025-11-17  &#10;**更新人**: [您的名字]&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/xyz/firestige/executor/application/dto/TenantConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/xyz/firestige/executor/application/dto/TenantConfig.java" />
              <option name="updatedContent" value="package xyz.firestige.executor.application.dto;&#10;&#10;import xyz.firestige.entity.deploy.NetworkEndpoint;&#10;&#10;import java.util.List;&#10;&#10;/**&#10; * 租户配置（内部 DTO）&#10; * 用于应用服务层，与外部 DTO（TenantDeployConfig）解耦&#10; * 只包含应用层业务逻辑需要的字段&#10; */&#10;public class TenantConfig {&#10;    &#10;    // 核心标识&#10;    private Long deployUnitId;&#10;    private Long deployUnitVersion;&#10;    private String deployUnitName;&#10;    private String tenantId;&#10;    &#10;    // 健康检查相关&#10;    private List&lt;NetworkEndpoint&gt; healthCheckEndpoints;&#10;    &#10;    // 配置相关&#10;    private String nacosNameSpace;&#10;    private Boolean defaultFlag;&#10;    &#10;    // Plan 相关&#10;    private Long planId;&#10;    private Long planVersion;&#10;    &#10;    // 回滚相关（上一次成功配置）&#10;    private TenantConfig previousConfig;&#10;    private Long previousConfigVersion;&#10;    &#10;    // 业务规则（如果应用层需要）&#10;    private String calledNumberRules;&#10;    private String trunkGroup;&#10;    &#10;    // 构造器&#10;    public TenantConfig() {&#10;    }&#10;    &#10;    // Getters and Setters&#10;    &#10;    public Long getDeployUnitId() {&#10;        return deployUnitId;&#10;    }&#10;    &#10;    public void setDeployUnitId(Long deployUnitId) {&#10;        this.deployUnitId = deployUnitId;&#10;    }&#10;    &#10;    public Long getDeployUnitVersion() {&#10;        return deployUnitVersion;&#10;    }&#10;    &#10;    public void setDeployUnitVersion(Long deployUnitVersion) {&#10;        this.deployUnitVersion = deployUnitVersion;&#10;    }&#10;    &#10;    public String getDeployUnitName() {&#10;        return deployUnitName;&#10;    }&#10;    &#10;    public void setDeployUnitName(String deployUnitName) {&#10;        this.deployUnitName = deployUnitName;&#10;    }&#10;    &#10;    public String getTenantId() {&#10;        return tenantId;&#10;    }&#10;    &#10;    public void setTenantId(String tenantId) {&#10;        this.tenantId = tenantId;&#10;    }&#10;    &#10;    public List&lt;NetworkEndpoint&gt; getHealthCheckEndpoints() {&#10;        return healthCheckEndpoints;&#10;    }&#10;    &#10;    public void setHealthCheckEndpoints(List&lt;NetworkEndpoint&gt; healthCheckEndpoints) {&#10;        this.healthCheckEndpoints = healthCheckEndpoints;&#10;    }&#10;    &#10;    public String getNacosNameSpace() {&#10;        return nacosNameSpace;&#10;    }&#10;    &#10;    public void setNacosNameSpace(String nacosNameSpace) {&#10;        this.nacosNameSpace = nacosNameSpace;&#10;    }&#10;    &#10;    public Boolean getDefaultFlag() {&#10;        return defaultFlag;&#10;    }&#10;    &#10;    public void setDefaultFlag(Boolean defaultFlag) {&#10;        this.defaultFlag = defaultFlag;&#10;    }&#10;    &#10;    public Long getPlanId() {&#10;        return planId;&#10;    }&#10;    &#10;    public void setPlanId(Long planId) {&#10;        this.planId = planId;&#10;    }&#10;    &#10;    public Long getPlanVersion() {&#10;        return planVersion;&#10;    }&#10;    &#10;    public void setPlanVersion(Long planVersion) {&#10;        this.planVersion = planVersion;&#10;    }&#10;    &#10;    public TenantConfig getPreviousConfig() {&#10;        return previousConfig;&#10;    }&#10;    &#10;    public void setPreviousConfig(TenantConfig previousConfig) {&#10;        this.previousConfig = previousConfig;&#10;    }&#10;    &#10;    public Long getPreviousConfigVersion() {&#10;        return previousConfigVersion;&#10;    }&#10;    &#10;    public void setPreviousConfigVersion(Long previousConfigVersion) {&#10;        this.previousConfigVersion = previousConfigVersion;&#10;    }&#10;    &#10;    public String getCalledNumberRules() {&#10;        return calledNumberRules;&#10;    }&#10;    &#10;    public void setCalledNumberRules(String calledNumberRules) {&#10;        this.calledNumberRules = calledNumberRules;&#10;    }&#10;    &#10;    public String getTrunkGroup() {&#10;        return trunkGroup;&#10;    }&#10;    &#10;    public void setTrunkGroup(String trunkGroup) {&#10;        this.trunkGroup = trunkGroup;&#10;    }&#10;    &#10;    @Override&#10;    public String toString() {&#10;        return &quot;TenantConfig{&quot; +&#10;                &quot;deployUnitId=&quot; + deployUnitId +&#10;                &quot;, deployUnitVersion=&quot; + deployUnitVersion +&#10;                &quot;, deployUnitName='&quot; + deployUnitName + '\'' +&#10;                &quot;, tenantId='&quot; + tenantId + '\'' +&#10;                &quot;, planId=&quot; + planId +&#10;                '}';&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>