<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/state/TaskEventTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/xyz/firestige/executor/unit/state/TaskEventTest.java" />
              <option name="updatedContent" value="package xyz.firestige.executor.unit.state;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Tag;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import xyz.firestige.executor.exception.ErrorType;&#10;import xyz.firestige.executor.exception.FailureInfo;&#10;import xyz.firestige.executor.orchestration.ExecutionMode;&#10;import xyz.firestige.executor.state.TaskStatus;&#10;import xyz.firestige.executor.state.event.*;&#10;import xyz.firestige.executor.util.TimingExtension;&#10;import xyz.firestige.executor.validation.ValidationError;&#10;&#10;import java.util.List;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * 事件类单元测试&#10; * 测试各种状态事件的创建和属性&#10; * &#10; * 预计执行时间：60 秒（10 个测试）&#10; */&#10;@Tag(&quot;unit&quot;)&#10;@Tag(&quot;fast&quot;)&#10;@ExtendWith(TimingExtension.class)&#10;@DisplayName(&quot;事件类单元测试&quot;)&#10;class TaskEventTest {&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.1: 事件自动生成 ID&quot;)&#10;    void testEventIdGeneration() {&#10;        // When: 创建两个事件&#10;        TaskCreatedEvent event1 = new TaskCreatedEvent(&quot;task1&quot;, 5, ExecutionMode.CONCURRENT);&#10;        TaskCreatedEvent event2 = new TaskCreatedEvent(&quot;task2&quot;, 3, ExecutionMode.FIFO);&#10;        &#10;        // Then: ID 非空且唯一&#10;        assertNotNull(event1.getEventId(), &quot;事件ID不应该为null&quot;);&#10;        assertNotNull(event2.getEventId(), &quot;事件ID不应该为null&quot;);&#10;        assertNotEquals(event1.getEventId(), event2.getEventId(), &quot;事件ID应该唯一&quot;);&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.2: 事件自动设置时间戳&quot;)&#10;    void testEventTimestamp() {&#10;        // Given: 记录当前时间&#10;        long before = System.currentTimeMillis();&#10;        &#10;        // When: 创建事件&#10;        TaskStartedEvent event = new TaskStartedEvent(&quot;task1&quot;, 5);&#10;        &#10;        // Then: 时间戳接近当前时间&#10;        long after = System.currentTimeMillis();&#10;        assertNotNull(event.getTimestamp());&#10;        long eventTime = event.getTimestamp().getTime();&#10;        assertTrue(eventTime &gt;= before &amp;&amp; eventTime &lt;= after + 100, &#10;                &quot;事件时间戳应该接近创建时间&quot;);&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.3: TaskCreatedEvent 包含配置��量&quot;)&#10;    void testTaskCreatedEvent() {&#10;        // When: 创建事件&#10;        TaskCreatedEvent event = new TaskCreatedEvent(&quot;task1&quot;, 5, ExecutionMode.CONCURRENT);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(5, event.getConfigCount());&#10;        assertEquals(ExecutionMode.CONCURRENT, event.getMode());&#10;        assertEquals(TaskStatus.CREATED, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.4: TaskValidationFailedEvent 包含错误列表&quot;)&#10;    void testTaskValidationFailedEvent() {&#10;        // Given: 创建错误列表&#10;        List&lt;ValidationError&gt; errors = List.of(&#10;            ValidationError.of(&quot;field1&quot;, &quot;错误1&quot;),&#10;            ValidationError.of(&quot;field2&quot;, &quot;错误2&quot;),&#10;            ValidationError.of(&quot;field3&quot;, &quot;错误3&quot;)&#10;        );&#10;        &#10;        // When: 创建事件&#10;        TaskValidationFailedEvent event = new TaskValidationFailedEvent(&quot;task1&quot;, errors);&#10;        &#10;        // Then: 包含所有错误&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(3, event.getErrors().size());&#10;        assertEquals(TaskStatus.VALIDATION_FAILED, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.5: TaskProgressEvent 计算进度百分比&quot;)&#10;    void testTaskProgressEvent() {&#10;        // When: 创建进度事件&#10;        TaskProgressEvent event = new TaskProgressEvent(&quot;task1&quot;, 3, 10);&#10;        &#10;        // Then: 进度计算正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(3, event.getCompletedStages());&#10;        assertEquals(10, event.getTotalStages());&#10;        assertEquals(30.0, event.getProgress(), 0.01, &quot;进度应该是30%&quot;);&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.6: TaskStartedEvent 基本属性&quot;)&#10;    void testTaskStartedEvent() {&#10;        // When: 创建事件&#10;        TaskStartedEvent event = new TaskStartedEvent(&quot;task1&quot;, 5);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(5, event.getTotalStages());&#10;        assertEquals(TaskStatus.RUNNING, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.7: TaskCompletedEvent 包含持续时间&quot;)&#10;    void testTaskCompletedEvent() {&#10;        // When: 创建事件&#10;        TaskCompletedEvent event = new TaskCompletedEvent(&quot;task1&quot;, 5000L, List.of());&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(5000L, event.getDuration());&#10;        assertEquals(TaskStatus.COMPLETED, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.8: TaskFailedEvent 包含失败信息&quot;)&#10;    void testTaskFailedEvent() {&#10;        // Given: 失败信息&#10;        FailureInfo failureInfo = FailureInfo.of(ErrorType.SYSTEM_ERROR, &quot;系统错误&quot;);&#10;        &#10;        // When: 创建事件&#10;        TaskFailedEvent event = new TaskFailedEvent(&quot;task1&quot;, failureInfo);&#10;        &#10;        // Then: 包含失败信息&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertNotNull(event.getFailureInfo());&#10;        assertEquals(&quot;系统错误&quot;, event.getFailureInfo().getErrorMessage());&#10;        assertEquals(TaskStatus.FAILED, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.9: TaskPausedEvent 基本属性&quot;)&#10;    void testTaskPausedEvent() {&#10;        // When: 创建事件&#10;        TaskPausedEvent event = new TaskPausedEvent(&quot;task1&quot;, 3);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(3, event.getCurrentStage());&#10;        assertEquals(TaskStatus.PAUSED, event.getStatus());&#10;    }&#10;    &#10;    @Test&#10;    @DisplayName(&quot;场景 3.2.10: TaskStageCompletedEvent 包含 Stage 信息&quot;)&#10;    void testTaskStageCompletedEvent() {&#10;        // When: 创建事件&#10;        TaskStageCompletedEvent event = new TaskStageCompletedEvent(&quot;task1&quot;, &quot;Stage2&quot;, 1000L);&#10;        &#10;        // Then: 属性正确&#10;        assertEquals(&quot;task1&quot;, event.getTaskId());&#10;        assertEquals(&quot;Stage2&quot;, event.getStageName());&#10;        assertEquals(1000L, event.getDuration());&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>