# Deployment Stage Configuration for RF-19
# RF-19 使用代码编排（DynamicStageFactory），不依赖 YAML 配置 stages
# 此文件仅保留基础设施配置

# ========== Infrastructure Configuration ==========
infrastructure:
  # Redis Configuration
  redis:
    hashKeyPrefix: "icc_ai_ops_srv:tenant_config:"
    pubsubTopic: "icc_ai_ops_srv:tenant_config:topic"
  
  # Nacos Service Discovery Configuration
  nacos:
    services:
      blueGreenGatewayService: "blue-green-gateway-service"
      portalService: "portal-service"
      asbcService: "asbc-gateway-service"
      obService: "ob-service"

  # Service Discovery Fallback Configuration
  # Use fixed IPs when Nacos unavailable
  fallbackInstances:
    blue-green-gateway:
      - "192.168.1.10:8080"
      - "192.168.1.11:8080"
    portal:
      - "192.168.1.20:8080"
    asbc:
      - "192.168.1.100:8080"
      - "192.168.1.101:8080"
    ob-service:
      - "192.168.1.30:8080"

  # Authentication Configuration
  # RF-19: enabled=false 不填 Authorization header
  #        enabled=true + tokenProvider=random 生成随机 hex
  auth:
    asbc:
      enabled: false
      tokenProvider: "random"
    portal:
      enabled: false
    ob-service:
      enabled: false

  # Health Check Configuration (for Blue-Green Gateway)
  healthCheck:
    defaultPath: "/actuator/bg-sdk/{tenantId}"
    intervalSeconds: 3
    maxAttempts: 10

# ========== Default Service Names ==========
# 默认的服务切换顺序（当外部未指定时使用）
defaultServiceNames:
  - asbc-gateway
  - portal
  - blue-green-gateway

# ========== 注意 ==========
# RF-19 使用 DynamicStageFactory 进行代码编排
# Stage 和 Step 的创建逻辑在代码中实现，不依赖 YAML 配置
#
# Stage 创建位置：
# - DynamicStageFactory.buildStages(TenantConfig)
# - 根据 TenantConfig 动态创建 ASBC、Portal、OBService 等 Stage
#
# Step 类型（通用，可复用）：
# - HttpRequestStep: HTTP 请求（ASBC、Portal 复用）
# - ConfigWriteStep: Redis HSET（OBService、蓝绿网关复用）
# - PollingStep: 轮询（OBService 使用）
# - MessageBroadcastStep: Redis Pub/Sub（蓝绿网关使用）
# - EndpointPollingStep: 健康检查（蓝绿网关使用）
#
# 业务逻辑位置：
# - DataPreparer: 准备 Step 执行数据
# - ResultValidator: 验证 Step 执行结果
# - ConfigurableServiceStage: 编排 Preparer + Step + Validator


